<?xml version="1.0" encoding="UTF-8"?>
<form:Form xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dync="http://www.chinacreator.com/platform/mvc/ui/dync" xmlns:form="http://www.chinacreator.com/platform/mvc/form" name="修改密码" res="aGksdAEfTOeaWAuxp2Qf5Q" sn="modifyPwd" type="form">
  <form:control type="page/normal">
    <form:attributes source="page/normal">
      <dync:attribute default="" group="HTML" id="showHead" name="显示标题" value="">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="" group="HTML" id="title" name="标题" value="">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="" group="HTML" id="desc" name="描述" value="">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="" group="事件" id="onload" name="载入事件" value="">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
      <dync:attribute default="false" group="HTML" id="fixedHeight" name="自动高度" value="true">
        <dync:render/>
        <dync:children/>
      </dync:attribute>
    </form:attributes>
  </form:control>
  <form:child xsi:type="form:Group" id="newGroupId" name="修改密码">
    <form:control type="container/widgetbox">
      <form:attributes source="container/widgetbox">
        <dync:attribute default="" group="HTML配置" id="style" name="样式" value="margin-top:5px;">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
        <dync:attribute default="false" group="HTML配置" id="autoHeight" name="自动高度" value="true">
          <dync:render/>
          <dync:children/>
        </dync:attribute>
      </form:attributes>
    </form:control>
    <form:child xsi:type="form:Group" id="newGroup3" name="标题栏工具条">
      <form:control type="container/toolbar_widget">
        <form:attributes source="container/toolbar_widget"/>
      </form:control>
    </form:child>
    <form:child xsi:type="form:Group" id="newGroup1" name="通用容器">
      <form:control type="container/div">
        <form:attributes source="container/div">
          <dync:attribute default="12" group="HTML配置" id="span" name="占位数" value="8">
            <dync:render/>
            <dync:children/>
          </dync:attribute>
          <dync:attribute default="0" group="HTML配置" id="offset" name="偏移" value="2">
            <dync:render/>
            <dync:children/>
          </dync:attribute>
        </form:attributes>
      </form:control>
      <form:child xsi:type="form:Field" binding="model.user.result.userName" id="userName" name="账号：">
        <form:control type="widget/text">
          <form:attributes source="widget/text">
            <dync:attribute default="6" group="布局属性" id="span" name="占位数" value="12">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="false" group="HTML设置" id="readonly" name="只读状态" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="false" group="HTML设置" id="disabled" name="禁用" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
      </form:child>
      <form:child xsi:type="form:Field" binding="$model.user.result.userRealname" id="userRealname" name="姓名：">
        <form:control type="widget/text">
          <form:attributes source="widget/text">
            <dync:attribute default="false" group="HTML设置" id="disabled" name="禁用" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="6" group="布局属性" id="span" name="占位数" value="12">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
      </form:child>
      <form:child xsi:type="form:Field" binding="model.oldPwd" id="newField" name="原密码：" customize="true">
        <form:control type="widget/text">
          <form:attributes source="widget/text">
            <dync:attribute default="6" group="布局属性" id="span" name="占位数" value="12">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="false" group="数据校验" id="required" name="必填项" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="minlength" name="最小长度" value="6">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="maxlength" name="最大长度" value="100">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="text" group="HTML设置" id="inputType" name="数据类型" value="password">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:validation/>
      </form:child>
      <form:child xsi:type="form:Field" binding="model.newPwd" id="newField1" name="新密码：" customize="true">
        <form:control type="widget/text">
          <form:attributes source="widget/text">
            <dync:attribute default="6" group="布局属性" id="span" name="占位数" value="12">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="false" group="数据校验" id="required" name="必填项" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="minlength" name="最小长度" value="6">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="maxlength" name="最大长度" value="100">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="text" group="HTML设置" id="inputType" name="数据类型" value="password">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:validation/>
      </form:child>
      <form:child xsi:type="form:Field" binding="model.confirmPwd" id="newField2" name="确认密码：" customize="true">
        <form:control type="widget/text">
          <form:attributes source="widget/text">
            <dync:attribute default="6" group="布局属性" id="span" name="占位数" value="12">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="false" group="数据校验" id="required" name="必填项" value="true">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="minlength" name="最小长度" value="6">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="数据校验" id="maxlength" name="最大长度" value="100">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="text" group="HTML设置" id="inputType" name="数据类型" value="password">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:validation/>
      </form:child>
    </form:child>
    <form:child xsi:type="form:Group" id="newGroup" name="普通工具条">
      <form:control type="container/toolbar">
        <form:attributes source="container/toolbar"/>
      </form:control>
      <form:child xsi:type="form:Field" id="newField3" name="保存" res="20pkHCimSoKxM_BBRW0EeQ" customize="true">
        <form:control type="widget/button">
          <form:attributes source="widget/button">
            <dync:attribute default="btn-sm" group="HTML设置" id="size" name="尺寸" value="btn-lg">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="HTML设置" id="icon" name="图标" value="fa-save">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="btn-primary" group="HTML设置" id="style" name="样式" value="btn-success">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="事件设置" id="click" name="点击事件" value="modifyPwd()">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:validation/>
      </form:child>
      <form:child xsi:type="form:Field" id="newField4" name="重置" customize="true">
        <form:control type="widget/button">
          <form:attributes source="widget/button">
            <dync:attribute default="btn-sm" group="HTML设置" id="size" name="尺寸" value="btn-lg">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="HTML设置" id="icon" name="图标" value="fa-refresh">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
            <dync:attribute default="" group="事件设置" id="click" name="点击事件" value="resetPwd()">
              <dync:render/>
              <dync:children/>
            </dync:attribute>
          </form:attributes>
        </form:control>
        <form:validation/>
      </form:child>
    </form:child>
  </form:child>
  <form:datasources>
    <form:datasource xsi:type="form:Inputs"/>
    <form:datasource xsi:type="form:LogicDataSource" id="user" name="用户" logic="rule:asp.sysmgmt.mypanel.getLogUser" sn="getLogUser"/>
    <form:datasource xsi:type="form:LogicDataSource" id="defaultPwd" name="默认密码" logic="rule:asp.sysmgmt.mypanel.getDefaultPwd" sn="getDefaultPwd"/>
  </form:datasources>
  <form:scripts>// 保存
modifyPwd:function(){
	if($view.mainForm.check() &amp;&amp; this.confirmPwdValidate()){	
		$http.post(&quot;ws/modifyPwd&quot;,{userName:$model.user.result.userName,oldPassword:$model.oldPwd,newPassword:$model.newPwd})
				.success(function(data, status, headers, config){
					Messenger.post({
		                'message': &quot;修改密码成功！&quot;,
		                'type': 'success',
		            });
				});
	}else{
		Messenger.post({
            'message': &quot;保存失败！验证未通过！&quot;,
            'type': 'error',
        });
	}
},
// 重置
resetPwd:function(){
	$view.mainForm.clean();
	$model.user.$reload();
	$model.oldPwd = '';
	$model.newPwd = '';
	$model.confirmPwd = '';
},
// 自定义验证新密码与确认密码
confirmPwdValidate:function(){
	var isValidate = false;
	var newPwd = $model.newPwd;
	var confirmPwd = $model.confirmPwd;
	if(confirmPwd!=newPwd){
		isValidate = false;
		$view.newField1.setTipMessage(&quot;新密码与确认密码不一致！&quot;);
		$view.newField2.setTipMessage(&quot;新密码与确认密码不一致！&quot;);
	}else{
		isValidate = true;
	}
	
	if(isValidate){
		if(newPwd==$model.defaultPwd.result){
			isValidate = false;
			$view.newField1.setTipMessage(&quot;新密码不能与初始密码一致！&quot;);
			$view.newField2.setTipMessage(&quot;确认密码不能与初始密码一致！&quot;);
		}else{
			isValidate = true;	
		}
	}
	
	return isValidate;
}
</form:scripts>
</form:Form>
